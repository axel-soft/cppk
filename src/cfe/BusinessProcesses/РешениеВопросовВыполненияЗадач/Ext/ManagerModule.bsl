
&ИзменениеИКонтроль("РезультатВыполненияЗадачи")
Функция ЦППК_РезультатВыполненияЗадачи(Задача)

	РезультатВыполнения = Неопределено;

	Если ТипЗнч(Задача) = Тип("ЗадачаОбъект.ЗадачаИсполнителя") Тогда
		РеквизитыЗадачи = Задача;
	Иначе
		РеквизитыЗадачи = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(
		Задача, "Выполнена, ТочкаМаршрута, БизнесПроцесс");
	КонецЕсли;

	Если РеквизитыЗадачи.Выполнена = Истина
		И РеквизитыЗадачи.ТочкаМаршрута = ТочкиМаршрута.РассмотрениеИнициатором Тогда

		РеквизитыПроцесса = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(РеквизитыЗадачи.БизнесПроцесс, 
		"ВидВопроса, ПредметРассмотрения");

		Если РеквизитыПроцесса.ВидВопроса = Перечисления.ВидыВопросовВыполненияЗадач.ПереносСрока Тогда
#Вставка
			Если ТипЗнч(Задача) = Тип("ЗадачаОбъект.ЗадачаИсполнителя")
				И Задача.ДополнительныеСвойства.Свойство("ПереносСрока")
				И Задача.ДополнительныеСвойства.ПереносСрока Тогда
				
				РезультатВыполнения = Перечисления.ВариантыВыполненияПроцессовИЗадач.Положительно;
				ТТС_ОбщийМодуль.ЗаписатьСрокИполненияВРегистр(РеквизитыЗадачи.БизнесПроцесс);
				
			Иначе
#КонецВставки

			Если ТипЗнч(Задача) = Тип("ЗадачаОбъект.ЗадачаИсполнителя")
				И Задача.ДополнительныеСвойства.Свойство("ПереносСрока")
				И Задача.ДополнительныеСвойства.ПереносСрока Тогда

				РезультатВыполнения = Перечисления.ВариантыВыполненияПроцессовИЗадач.Положительно;

			Иначе

				КоличествоПереносовСрока = 
				ПереносСроковВыполненияЗадачВызовСервера.КоличествоПереносовСрокаПоЗадачеИЗаявкеНаПеренос(
				РеквизитыПроцесса.ПредметРассмотрения, РеквизитыЗадачи.БизнесПроцесс, Истина);

				Если КоличествоПереносовСрока > 0 Тогда
					РезультатВыполнения = Перечисления.ВариантыВыполненияПроцессовИЗадач.Положительно;
				Иначе
					РезультатВыполнения = Перечисления.ВариантыВыполненияПроцессовИЗадач.Отрицательно;
				КонецЕсли;

#Вставка
			КонецЕсли;
#КонецВставки
			КонецЕсли;

		КонецЕсли;

	КонецЕсли;

	Возврат РезультатВыполнения;

КонецФункции

&ИзменениеИКонтроль("ЗаголовокИОписаниеЗадачи")
Функция ЦППК_ЗаголовокИОписаниеЗадачи(БизнесПроцесс, ЗадачаОзнакомления)

	РеквизитыПроцесса = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(БизнесПроцесс,
	"ВидВопроса, ПредметРассмотрения, Описание");
		
	СтруктураВозврата = Новый Структура;
	СтруктураВозврата.Вставить("Заголовок", "");
	СтруктураВозврата.Вставить("Описание", "");

	ПолныйТекстСЗаголовком = "";
	Если ЗадачаОзнакомления Тогда

		Если РеквизитыПроцесса.ВидВопроса = Перечисления.ВидыВопросовВыполненияЗадач.ПереносСрока Тогда
			ПолныйТекстСЗаголовком = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Ознакомиться: перенос срока по задаче ""%1""'"),
			Строка(РеквизитыПроцесса.ПредметРассмотрения))
			+ Символы.ПС + СокрЛП(РеквизитыПроцесса.Описание);
		Иначе
			ПолныйТекстСЗаголовком = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Ознакомиться с ответом на вопрос: %1'"),
	#Вставка
	//++AxelSoft Шарапова 16.06.2025 САНФ-034514
			Символы.ПС + СокрЛП(РеквизитыПроцесса.Описание));
	//--AxelSoft Шарапова 16.06.2025 САНФ-034514
	#КонецВставки
	#Удаление
			СокрЛП(РеквизитыПроцесса.Описание));
	#КонецУдаления
		КонецЕсли;

	Иначе

		Если РеквизитыПроцесса.ВидВопроса = Перечисления.ВидыВопросовВыполненияЗадач.ПереносСрока Тогда
			ПолныйТекстСЗаголовком = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Согласовать перенос срока по задаче: %1'"),
			Строка(РеквизитыПроцесса.ПредметРассмотрения))
			+ Символы.ПС + СокрЛП(РеквизитыПроцесса.Описание);
		Иначе
			ПолныйТекстСЗаголовком = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Рассмотреть вопрос: %1'"),
	#Вставка
	//++AxelSoft Шарапова 16.06.2025 САНФ-034514
			Символы.ПС + СокрЛП(РеквизитыПроцесса.Описание));
	//--AxelSoft Шарапова 16.06.2025 САНФ-034514
	#КонецВставки
	#Удаление
			СокрЛП(РеквизитыПроцесса.Описание));
	#КонецУдаления
		КонецЕсли;

	КонецЕсли;

	СтрокиТекста = СтрРазделить(ПолныйТекстСЗаголовком, Символы.ПС, Истина);

	Если СтрокиТекста.Количество() = 0 Тогда
		Возврат СтруктураВозврата;
	КонецЕсли;

	ПерваяСтрока = СтрокиТекста[0];
	#Вставка
	//++AxelSoft Шарапова 16.06.2025 САНФ-034514
	ПерваяСтрока = ПерваяСтрока + СтрокиТекста[1];
	//--AxelSoft Шарапова 16.06.2025 САНФ-034514
	#КонецВставки
	СтрокиОписания = Новый Массив;

	Если СтрДлина(ПерваяСтрока) > 150 Тогда
		СтруктураВозврата.Заголовок = Лев(ПерваяСтрока, 146) + " ...";
		СтрокиОписания.Добавить(ПерваяСтрока);
	Иначе
		СтруктураВозврата.Заголовок = ПерваяСтрока;
	КонецЕсли;

	Для Индекс = 1 По СтрокиТекста.ВГраница() Цикл
		Если СтрокиОписания.Количество() = 0 И ПустаяСтрока(СтрокиТекста[Индекс]) Тогда
			Продолжить;
		КонецЕсли;

		СтрокиОписания.Добавить(СтрокиТекста[Индекс]);
	КонецЦикла;

	СтруктураВозврата.Описание = СтрСоединить(СтрокиОписания, Символы.ПС);

	Возврат СтруктураВозврата;

КонецФункции
