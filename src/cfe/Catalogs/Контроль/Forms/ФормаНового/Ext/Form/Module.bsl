
&НаСервере
Процедура ЦППК_ПриСозданииНаСервереВместо(Отказ, СтандартнаяОбработка)
	
	// СтандартныеПодсистемы.Свойства
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ИмяЭлементаДляРазмещения", "ГруппаДополнительныеРеквизиты");
	ДополнительныеПараметры.Вставить("ИмяЭлементаКоманднойПанели", "ГруппаКомПанельИсполнители");
	УправлениеСвойствами.ПриСозданииНаСервере(ЭтотОбъект, ДополнительныеПараметры);
	// Конец СтандартныеПодсистемы.Свойства
	
	ПредметПроцессЗадача = Ложь;
	Если ЗначениеЗаполнено(Объект.Предмет) Тогда 
		Если ОбщегоНазначения.ЭтоБизнесПроцесс(Объект.Предмет.Метаданные())
		 Или ТипЗнч(Объект.Предмет) = Тип("ЗадачаСсылка.ЗадачаИсполнителя") Тогда 
			ПредметПроцессЗадача = Истина; 
		КонецЕсли; 
	КонецЕсли;
	
	ПроцессЗадачаЗавершен = Ложь;	
	Если ПредметПроцессЗадача Тогда 
		Если ОбщегоНазначения.ЭтоБизнесПроцесс(Объект.Предмет.Метаданные()) Тогда 
			ПроцессЗадачаЗавершен = Объект.Предмет.Завершен 
				Или Объект.Предмет.Состояние = Перечисления.СостоянияБизнесПроцессов.Прерван;
		ИначеЕсли ТипЗнч(Объект.Предмет) = Тип("ЗадачаСсылка.ЗадачаИсполнителя") Тогда 
			ПроцессЗадачаЗавершен = Объект.Предмет.Выполнена;
		КонецЕсли;
	
	ИначеЕсли ДействияКлиентСервер.ЭтоДействие(Объект.Предмет) Тогда 
		Если ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Предмет, "ПомещеноВИсторию") = Истина Тогда
			ПроцессЗадачаЗавершен = Истина;
		Иначе
			СостояниеДействия = РегистрыСведений.СостоянияДействий.СостояниеДействия(Объект.Предмет);
			Если СостояниеДействия = Перечисления.СостоянияВыполненияДействий.Завершено 
				Или СостояниеДействия = Перечисления.СостоянияВыполненияДействий.Пропущено Тогда
				ПроцессЗадачаЗавершен = Истина;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;		
	
	// Заполнение готовых вариантов контрольных сроков
	СписокВыбора = Элементы.СрокИсполнения.СписокВыбора;
	Элементы.СрокИсполнения.СписокВыбора.Добавить(ТекущаяДата() + 24*3600,			НСтр("ru = 'Завтра'"));
	Элементы.СрокИсполнения.СписокВыбора.Добавить(ТекущаяДата() + 2*24*3600, 		НСтр("ru = '2 дня'"));	
	Элементы.СрокИсполнения.СписокВыбора.Добавить(ТекущаяДата() + 3*24*3600, 		НСтр("ru = '3 дня'"));	
	Элементы.СрокИсполнения.СписокВыбора.Добавить(ТекущаяДата() + 7*24*3600, 		НСтр("ru = 'Неделя'"));
	Элементы.СрокИсполнения.СписокВыбора.Добавить(ДобавитьМесяц(ТекущаяДата(), 1), 	НСтр("ru = 'Месяц'"));
	
	ЦветЗеленый = ЦветаСтиля.ОтметкаПоложительногоВыполненияЗадачи;
	ЦветКрасный = ЦветаСтиля.ОтметкаОтрицательногоВыполненияЗадачи;
	ТекущийПользователь = ПользователиКлиентСервер.ТекущийПользователь();
	
	Если ТипЗнч(Объект.Предмет) = Тип("СправочникСсылка.ВеткиПереписки") Тогда 
		ПредметСсылка = Объект.Предмет.КорневоеПисьмо;
	Иначе	
		ПредметСсылка = Объект.Предмет;
	КонецЕсли;	
	ПредметСтрокой = Контроль.СформироватьПредставлениеПредмета(ПредметСсылка);
	
	// Видимость поля "Предмет"
	Если ЗначениеЗаполнено(Объект.Предмет) Тогда 
		Элементы.ГруппаОписаниеСтраницы.ТекущаяСтраница = Элементы.ГруппаОписаниеИПредмет;
	Иначе
		Элементы.ГруппаОписаниеСтраницы.ТекущаяСтраница = Элементы.ГруппаОписание;
	КонецЕсли;
			
	Элементы.ГруппаИсполнителиПодписьКомПанель.ТекущаяСтраница = Элементы.СтраницаНадписьКомПанель;
	Если ЗначениеЗаполнено(Объект.Предмет) Тогда 
		Если ПредметПроцессЗадача Или ДействияКлиентСервер.ЭтоДействие(Объект.Предмет) Тогда 
			Элементы.Исполнители.ИзменятьСоставСтрок = Ложь;
			Элементы.Исполнители.ИзменятьПорядокСтрок = Ложь;
			Элементы.Исполнители.ТолькоПросмотр = Истина;
			Элементы.ГруппаИсполнителиПодписьКомПанель.ТекущаяСтраница = Элементы.СтраницаТолькоНадпись;
		ИначеЕсли ВстроеннаяПочтаКлиентСервер.ЭтоПисьмо(ПредметСсылка) Тогда 
			Элементы.Исполнители.ИзменятьСоставСтрок = Ложь;
			Элементы.ИсполнителиИсполнитель.ТолькоПросмотр = Истина;
			Элементы.Подобрать.Видимость = Ложь;
			Элементы.Добавить.Видимость = Ложь;
			Элементы.Удалить.Видимость = Ложь;
			Если Объект.Исполнители.Количество() = 1 Тогда
				Элементы.Исполнители.ИзменятьПорядокСтрок = Ложь;
				Элементы.ГруппаИсполнителиПодписьКомПанель.ТекущаяСтраница = Элементы.СтраницаТолькоНадпись;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	// МДК ++ нужен список со всеми пользователями
	// возможные контролеры
	//Контроль.ЗаполнитьСписокКонтролеров(Контролеры, Элементы.Контролер);
	// МДК --
	
	Если ЗначениеЗаполнено(Объект.Описание) И Не ЗначениеЗаполнено(Объект.СрокИсполнения) Тогда
		Элементы.СрокИсполнения.АктивизироватьПоУмолчанию = Истина;
	КонецЕсли;
	
	// Сохранение вводимых значений
	СохранениеВводимыхЗначений.ЗаполнитьСписокВыбора(ЭтаФорма, ЭлементыДляСохранения(), "Справочник.Контроль.ФормаЭлементаИФормаНового");
	
	ПроверятьОтсутствие = Отсутствия.ПредупреждатьОбОтсутствии();
	
	// СтандартныеПодсистемы.ВерсионированиеОбъектов
	ВерсионированиеОбъектов.ПриСозданииНаСервере(ЭтаФорма);
	// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов
	
	Если ОбщегоНазначения.ЭтоМобильныйКлиент() Тогда
		//НастроитьЭлементыФормыДляМобильногоУстройства();
	КонецЕсли;

КонецПроцедуры
