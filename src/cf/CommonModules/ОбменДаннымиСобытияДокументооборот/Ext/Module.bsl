////////////////////////////////////////////////////////////////////////////////
// Подсистема "Обмен данными"
//
////////////////////////////////////////////////////////////////////////////////

#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

////////////////////////////////////////////////////////////////////////////////
// Обработчики событий изменения данных

#Область ОбменЧерезУниверсальныйФормат

// Процедура-обработчик события "ПередЗаписью" ссылочных типов данных (кроме документов) для механизма регистрации объектов на узлах
//
// Параметры:
//   Источник - СправочникОбъект
//            - ПланВидовХарактеристикОбъект - источник события, кроме типа ДокументОбъект.
//   Отказ - Булево - флаг отказа от выполнения обработчика.
//
Процедура СинхронизацияДанныхЧерезУниверсальныйФорматПередЗаписью(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписью(
		"СинхронизацияДанныхЧерезУниверсальныйФормат",
		Источник,
		Отказ);
	
КонецПроцедуры

// Процедура-обработчик события "ПередЗаписью" регистров для механизма регистрации объектов на узлах
//
// Параметры:
//   Источник - РегистрСведенийНаборЗаписей - источник события.
//   Отказ - Булево - флаг отказа от выполнения обработчика.
//   Замещение - Булево - признак замещения существующего набора записей.
//
Процедура СинхронизацияДанныхЧерезУниверсальныйФорматПередЗаписьюРегистра(Источник, Отказ, Замещение) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписьюРегистра(
		"СинхронизацияДанныхЧерезУниверсальныйФормат",
		Источник,
		Отказ,
		Замещение);
	
КонецПроцедуры

// Процедура-обработчик события "ПередУдалением" ссылочных типов данных для механизма регистрации объектов на узлах
//
// Параметры:
//   Источник - СправочникОбъект
//            - ДокументОбъект
//            - ПланВидовХарактеристикОбъект - источник события.
//   Отказ - Булево - флаг отказа от выполнения обработчика.
//
Процедура СинхронизацияДанныхЧерезУниверсальныйФорматПередУдалением(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередУдалением(
		"СинхронизацияДанныхЧерезУниверсальныйФормат",
		Источник,
		Отказ);
	
КонецПроцедуры

#КонецОбласти

////////////////////////////////////////////////////////////////////////////////
// Обмен ДО - БП

Процедура ОбменДаннымиДОБППередЗаписью(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписью("ОбменБухгалтерияПредприятияДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОБППередЗаписьюРегистра(Источник, Отказ, Замещение) Экспорт
	
	Если Источник.Отбор.Найти("Состояние") <> Неопределено
			И Источник.Отбор.Состояние.Значение = Перечисления.СостоянияДокументов.Согласован
			И Источник.Количество() > 0 
			И Источник.Отбор.Найти("Документ") <> Неопределено
			И ТипЗнч(Источник.Отбор.Документ.Значение) = Тип("СправочникСсылка.ДокументыПредприятия") Тогда
		
		Узлы = ОбменДаннымиДокументооборотПовтИсп.УзлыПланаОбмена("ОбменБухгалтерияПредприятияДокументооборот20");
		ПланыОбмена.ЗарегистрироватьИзменения(Узлы, Источник.Отбор.Документ.Значение);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбменДаннымиДОБППередУдалением(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередУдалением("ОбменБухгалтерияПредприятияДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Обмен ДО - УП

Процедура ОбменДаннымиДОУППередЗаписью(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписью("ОбменУправлениеПредприятиемДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУППередЗаписьюРегистра(Источник, Отказ, Замещение) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписьюРегистра("ОбменУправлениеПредприятиемДокументооборот20", Источник, Отказ, Замещение);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУППередЗаписьюКонстанты(Источник, Отказ) Экспорт
		
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписьюКонстанты("ОбменУправлениеПредприятиемДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУППередУдалением(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередУдалением("ОбменУправлениеПредприятиемДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Обмен ДО - УТ

Процедура ОбменДаннымиДОУТПередЗаписью(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписью("ОбменУправлениеТорговлейДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУТПередЗаписьюРегистра(Источник, Отказ, Замещение) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписьюРегистра("ОбменУправлениеТорговлейДокументооборот20", Источник, Отказ, Замещение);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУТПередЗаписьюКонстанты(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписьюКонстанты("ОбменУправлениеТорговлейДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУТПередУдалением(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередУдалением("ОбменУправлениеТорговлейДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Обмен ДО - УПП 1.3

Процедура ОбменДаннымиДОУПП13ПередЗаписью(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписью(
		"ОбменУправлениеПроизводственнымПредприятиемДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУПП13ПередЗаписьюРегистра(Источник, Отказ, Замещение) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписьюРегистра(
		"ОбменУправлениеПроизводственнымПредприятиемДокументооборот20", Источник, Отказ, Замещение);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУПП13ПередУдалением(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередУдалением(
		"ОбменУправлениеПроизводственнымПредприятиемДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Обмен ДО - УХ

Процедура ОбменДаннымиДОУХПередЗаписью(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередЗаписью("ОбменУправлениеХолдингомДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

Процедура ОбменДаннымиДОУХПередУдалением(Источник, Отказ) Экспорт
	
	ОбменДаннымиСобытия.МеханизмРегистрацииОбъектовПередУдалением("ОбменУправлениеХолдингомДокументооборот20", Источник, Отказ);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Обмен ДО21 - ДО21

Процедура ОбменДаннымиДО20ДО21ПередЗаписью(Источник, Отказ) Экспорт
	
	Если Не Источник.ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбменДаннымиДО20ДО21ПередЗаписьюДокумента(Источник, Отказ) Экспорт
	
	Если Не Источник.ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбменДаннымиДО20ДО21ПередЗаписьюРегистра(Источник, Отказ, Замещение) Экспорт
	
	Если Не Источник.ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли