
#Область ПрограммныйИнтерфейс

// Метод добавлен для обеспечения работы подсистем ЭП версии БСП 3.1.10.295
// Записывает в журнал регистрации событие при выполнении обработчика обновления.
// При записи ошибки или предупреждения сохраняет эту информацию в сведениях об обработчике
// обновления для дальнейшей индикации в интерфейсах механизма обновления.
//
// Параметры:
//  СсылкаМетаданные - ЛюбаяСсылка, ОбъектМетаданных - для ссылочных объектов ссылка, для остальных метаданные
//  Представление    - Строка - строковое представление обрабатываемых данных. Для ссылок необходимо получать его до
//                                 начала обработки, т.к. получение в блоке исключения может приводить к ошибке.
//  ИнформацияОбОшибке - ИнформацияОбОшибке, Строка - можно передавать объект ИнформацияОбОшибке для записи
//                                 стандартной ошибки в журнал регистрации. Для уточнения текста проблемы
//                                 стоит передавать строковый комментарий.
//  Уровень - УровеньЖурналаРегистрации - уровень важности события. Если не указано, то записывается событие с уровнем Предупреждение.
//
Процедура ЗаписатьОшибкуВЖурналРегистрации(СсылкаМетаданные, Знач Представление, ИнформацияОбОшибке = Неопределено, Уровень = Неопределено) Экспорт
	
	Данные = Неопределено;
	ОбъектМетаданных = Неопределено;
	Если ОбщегоНазначения.ЭтоСсылка(ТипЗнч(СсылкаМетаданные)) Тогда
		Данные = СсылкаМетаданные;
		ОбъектМетаданных = СсылкаМетаданные.Метаданные();
	Иначе
		ОбъектМетаданных = СсылкаМетаданные;
	КонецЕсли;
	
	ТекстОшибки = "";
	Если ТипЗнч(ИнформацияОбОшибке) = Тип("Строка") Тогда
		ТекстОшибки = ИнформацияОбОшибке;
	Иначе
		ТекстОшибки = ОбработкаОшибок.ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Представление) Тогда
		Представление = ОбъектМетаданных.Имя;
	КонецЕсли;
	
	ТекстСообщения = НСтр("ru = 'Не удалось обработать ""%1"" по причине:
		|%2'");
	ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения,
		Представление,
		ТекстОшибки);
	
	ЗаписьЖурналаРегистрации(СобытиеЖурналаРегистрации(),
		УровеньЖурналаРегистрации.Предупреждение,
		ОбъектМетаданных,
		Данные,
		ТекстСообщения);
	
	ИмяОбработчика = ПараметрыСеанса.ПараметрыОбработчикаОбновления.ИмяОбработчика;
	Если Уровень = УровеньЖурналаРегистрации.Ошибка
		Или Уровень = Неопределено Тогда
		ОбновлениеИнформационнойБазыСлужебный.ДобавитьИнформациюОбОшибкеВОбработчике(ИмяОбработчика);
	ИначеЕсли Уровень = УровеньЖурналаРегистрации.Предупреждение Тогда
		ОбновлениеИнформационнойБазыСлужебный.ДобавитьИнформациюОбОшибкеВОбработчике(ИмяОбработчика);
	КонецЕсли;
	
КонецПроцедуры

// Метод добавлен для обеспечения работы подсистем ЭП версии БСП 3.1.10.295
// Возвращает строковую константу для формирования сообщений журнала регистрации.
//
// Возвращаемое значение:
//   Строка - текст события журнала регистрации.
//
Функция СобытиеЖурналаРегистрации() Экспорт
	
	Возврат ОбновлениеИнформационнойБазыСлужебный.СобытиеЖурналаРегистрации();
	
КонецФункции

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// Код процедур и функций

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Код процедур и функций

#КонецОбласти
