#Область ПрограммныйИнтерфейс

// Начинает выбор авансового отчета из формы заявки.
//
Процедура НачатьВыборАвансовогоОтчета(ФормаЗаявки, ЭлементАвансовыйОтчет) Экспорт
	
	ВидДокументаЗаявка = ФормаЗаявки.Объект.ВидДокумента;
	ВидыДокументовАвансовыйОтчет = ЗаявкиНаОплатуВызовСервера.
		ВидыДокументовПоСвязиАвансовыйОтчет(ВидДокументаЗаявка);
	ОбщегоНазначенияКлиентСервер.УдалитьВсеВхожденияЗначенияИзМассива(ВидыДокументовАвансовыЙОтчет,
		ПредопределенноеЗначение("Справочник.ВидыДокументов.ПустаяСсылка"));
		
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Отбор", Новый Структура);
	Если ВидыДокументовАвансовыйОтчет.Количество() <> 0 Тогда
		ПараметрыФормы.Отбор.Вставить("ВидДокумента", ВидыДокументовАвансовыйОтчет);
	КонецЕсли;
	ОткрытьФорму("Справочник.ДокументыПредприятия.ФормаВыбора",
		ПараметрыФормы,
		ЭлементАвансовыйОтчет,,,,,
		РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
		
КонецПроцедуры
	
// Начинает создание авансового отчета из формы заявки.
//
Процедура НачатьСозданиеАвансовогоОтчета(ФормаЗаявки, ЭлементАвансовыйОтчет) Экспорт
	
	ВидДокументаЗаявка = ФормаЗаявки.Объект.ВидДокумента;
	ВидыДокументовАвансовыйОтчет = ЗаявкиНаОплатуВызовСервера.
		ВидыДокументовПоСвязиАвансовыйОтчет(ВидДокументаЗаявка);
	ОбщегоНазначенияКлиентСервер.УдалитьВсеВхожденияЗначенияИзМассива(ВидыДокументовАвансовыЙОтчет,
		ПредопределенноеЗначение("Справочник.ВидыДокументов.ПустаяСсылка"));
		
	Если ВидыДокументовАвансовыйОтчет.Количество() = 1 Тогда
		
		ЗначенияЗаполнения = Новый Структура;
		ЗначенияЗаполнения.Вставить("ВидДокумента", ВидыДокументовАвансовыйОтчет[0]);
		ЗначенияЗаполнения.Вставить("Основание", ФормаЗаявки.Объект.Ссылка);
		
		ПараметрыФормы = Новый Структура;
		ПараметрыФормы.Вставить("ЗначенияЗаполнения", ЗначенияЗаполнения);
		ПараметрыФормы.Вставить("РежимВыбора", Истина);
		
		Контекст = Новый Структура("ФормаЗаявки, ЭлементАвансовыйОтчет",
			ФормаЗаявки, ЭлементАвансовыйОтчет);
		
		ОценкаПроизводительностиКлиент.НачатьЗамерВремени(Истина,
			"ДокументыПредприятияВыполнениеКомандыСоздать");
		
		ОткрытьФорму("Справочник.ДокументыПредприятия.ФормаОбъекта",
			ПараметрыФормы,
			ЭлементАвансовыйОтчет);
		
	Иначе
		
		ПараметрыФормы = Новый Структура;
		ПараметрыФормы.Вставить("ТипШаблонаДокумента", "ШаблоныДокументов");
		ПараметрыФормы.Вставить("ВозможностьСозданияПустогоДокумента", Истина);
		
		Контекст = Новый Структура("ФормаЗаявки, ЭлементАвансовыйОтчет",
			ФормаЗаявки, ЭлементАвансовыйОтчет);
		ОписаниеОповещения = Новый ОписаниеОповещения(
			"СозданиеДокументаПоШаблонуЗавершение", ЭтотОбъект, Контекст);
		
		ОткрытьФорму(
			"ОбщаяФорма.СозданиеДокументаПоШаблону",
			ПараметрыФормы,,,,,
			ОписаниеОповещения,
			РежимОткрытияОкнаФормы.БлокироватьВесьИнтерфейс);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура СозданиеДокументаПоШаблонуЗавершение(Результат, Контекст) Экспорт
	
	Если НЕ ЗначениеЗаполнено(Результат) ИЛИ Результат = "ПрерватьОперацию" Тогда
		Возврат;
	КонецЕсли;
	
	ОценкаПроизводительностиКлиент.НачатьЗамерВремени(Истина,
		"ДокументыПредприятияВыполнениеКомандыСоздать");
	
	Если (ТипЗнч(Результат) <> Тип("Строка")) Тогда 
		ШаблонДокумента = Результат.ШаблонДокумента;
	Иначе
		ШаблонДокумента = Результат;
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ШаблонДокумента", ШаблонДокумента);
	ПараметрыФормы.Вставить("РежимВыбора", Истина);
	
	Открытьформу(
		"Справочник.ДокументыПредприятия.ФормаОбъекта",
		ПараметрыФормы,
		Контекст.ЭлементАвансовыйОтчет);
	
КонецПроцедуры
	
#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#КонецОбласти