#Область ПрограммныйИнтерфейс

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Автотест") Тогда
		Возврат;
	КонецЕсли;
	
	НастройкиТранспорта = РегистрыСведений.НастройкиТранспортаКОД.Получить(Новый Структура("Узел", Параметры.Узел));
	Настройки = НастройкиТранспорта.Настройки.Получить();
	
	КодЭтогоУзла = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Справочники.УзлыКОД.ЭтотУзел, "Код");
	КодУзла = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Параметры.Узел, "Код");
	МаскаФайлов = СтрШаблон("%1to%2at*.json",
		КодЭтогоУзла,
		КодУзла);
		
	Каталог = ОбщегоНазначенияКлиентСервер.ДобавитьКонечныйРазделительПути(Настройки.ОбщийКаталог) + "errors";
	
	Файлы = НайтиФайлы(Каталог, МаскаФайлов, Ложь);
	Для Каждого Файл Из Файлы Цикл
		Сообщение = Сообщения.Добавить();
		Сообщение.ИмяСообщения = Файл.ИмяБезРасширения;
		Сообщение.Размер = Файл.Размер();
	КонецЦикла;
	
	Элементы.ДекорацияЕстьСообщения.Видимость = Сообщения.Количество() <> 0;
	Элементы.Сообщения.Доступность = Сообщения.Количество() <> 0;
	Элементы.ФормаВыбратьСообщение.Доступность = Сообщения.Количество() <> 0;
	Элементы.ДекорацияНетСообщений.Видимость = Сообщения.Количество() = 0;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКоманд

&НаКлиенте
Процедура ВыбратьСообщение(Команда)
	
	Если Элементы.Сообщения.ТекущиеДанные <> Неопределено Тогда
		Закрыть(Элементы.Сообщения.ТекущиеДанные.ИмяСообщения);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура СообщенияВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Если Элементы.Сообщения.ТекущиеДанные <> Неопределено Тогда
		Закрыть(Элементы.Сообщения.ТекущиеДанные.ИмяСообщения);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
