#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Делает запись в регистр.
//
// Параметры:
//  Задача - ДокументССылка.Задача
//  НомерИтерации - Число
//
Процедура ДобавитьЗапись(Задача, НомерИтерации) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запись = СоздатьМенеджерЗаписи();
	Запись.Задача = Задача;
	Запись.НомерИтерации = НомерИтерации;
	Запись.Записать(Истина);
	
КонецПроцедуры

// Получает номер итерации действия
//
// Параметры:
//  Задача - ДокументСсылка.Задача
//
Функция НомерИтерации(Задача) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запись = СоздатьМенеджерЗаписи();
	Запись.Задача = Задача;
	Запись.Прочитать();
	Если Запись.Выбран() Тогда
		Возврат Запись.НомерИтерации;
	КонецЕсли;
		
	Возврат 0;	
	
КонецФункции

// Инкрементирует
//
// Параметры:
//  Задача - ДокументССылка.Задача
//  НомерИтерации - Число
//
Процедура ИнкрементироватьНомерИтерации(Задача) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запись = СоздатьМенеджерЗаписи();
	Запись.Задача = Задача;
	Запись.Прочитать();
	
	Если Запись.Выбран() Тогда
		Запись.НомерИтерации = Запись.НомерИтерации + 1;
		Запись.Задача = Задача;
		Запись.Записать(Истина);
	Иначе
		Запись.НомерИтерации = 1;
		Запись.Задача = Задача;
		Запись.Записать(Истина);
	КонецЕсли;
	
КонецПроцедуры


#КонецОбласти

#КонецЕсли