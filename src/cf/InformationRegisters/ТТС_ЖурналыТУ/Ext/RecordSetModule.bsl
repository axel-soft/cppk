#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПриЗаписи(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;

	Если ЭтотОбъект.Количество() > 0 Тогда
		Если ЭтотОбъект[0].ВидЖурнала = Перечисления.ТТС_ВидыЖурналовТУ.Журнал2 	
			ИЛИ ЭтотОбъект[0].ВидЖурнала = Перечисления.ТТС_ВидыЖурналовТУ.Журнал3 Тогда
			
			ДанныеОтчетов = Новый Структура("ВнутреннийДокумент,Направление,КодНарушения,ДатаПоездки, ЯвляетсяНарушением");
			ЗаполнитьЗначенияСвойств(ДанныеОтчетов,ЭтотОбъект[0]);
			ДанныеОтчетов.ЯвляетсяНарушением = ЯвляетсяНарушением();
			РегистрыСведений.ТТС_ДанныеОтчетов.ЗаписатьДанныеОтчетов(ДанныеОтчетов);
			
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Функция ЯвляетсяНарушением()
	Если (ЭтотОбъект[0].ВидЖурнала = Перечисления.ТТС_ВидыЖурналовТУ.Журнал2 
		И ЗначениеЗаполнено(ЭтотОбъект[0].РезолюцияНачальникаДепо) 
		И НЕ ЭтотОбъект[0].РезолюцияНачальникаДепо = Справочники.ТТС_КодыВидовМерЖТУ.НД_ДействияМашинистаПравильные)
		ИЛИ (ЭтотОбъект[0].ВидЖурнала = Перечисления.ТТС_ВидыЖурналовТУ.Журнал3
		И ЗначениеЗаполнено(ЭтотОбъект[0].РезолюцияСБ) 
		И НЕ ЭтотОбъект[0].РезолюцияСБ = Справочники.ТТС_КодыВидовМерЖТУ.ЦР_ЗаписьОшибочна) Тогда
		
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли	
КонецФункции

#КонецОбласти

#Иначе
ВызватьИсключение НСтр("ru = 'Недопустимый вызов объекта на клиенте.'");
#КонецЕсли	