Процедура ЗаписатьДанныеОтчетов(ДанныеОтчета) Экспорт
	НаборЗаписей = РегистрыСведений.ТТС_ДанныеОтчетов.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.ВнутреннийДокумент.Установить(ДанныеОтчета.ВнутреннийДокумент);
	НаборЗаписей.Прочитать();
	НаборЗаписей.Очистить();
	НаборЗаписей.Записать();
	
	УстановитьПривилегированныйРежим(Истина);
	
	Если НЕ ДанныеОтчета.ВнутреннийДокумент.ПометкаУдаления И ЗаписыватьДанныеОтчетов(ДанныеОтчета) Тогда
		
		ГрафыОтчетов = ТТС_ОтчетыЖТУСервер.ПолучитьГрафыОтчетовПоКодуНарушения(ДанныеОтчета.КодНарушения, ДанныеОтчета.ЯвляетсяНарушением);
		Для Каждого ОтчетИГрафы ИЗ ГрафыОтчетов Цикл
			Для Каждого Графа ИЗ ОтчетИГрафы.Значение Цикл
				Запись = НаборЗаписей.Добавить();
				Запись.Период = ДанныеОтчета.ДатаПоездки;
				Запись.Отчет = ОтчетИГрафы.Ключ;
				Запись.ВнутреннийДокумент = ДанныеОтчета.ВнутреннийДокумент;
				Запись.Направление = ДанныеОтчета.Направление;
				Запись.ГрафаОтчета = Графа;
			КонецЦикла;
		КонецЦикла;
		НаборЗаписей.Записать();
	КонецЕсли;
	
КонецПроцедуры

Функция ЗаписыватьДанныеОтчетов(ДанныеОтчета)
	Если ЗначениеЗаполнено(ДанныеОтчета.КодНарушения) 
		И ЗначениеЗаполнено(ДанныеОтчета.Направление)
		И ЗначениеЗаполнено(ДанныеОтчета.ДатаПоездки) Тогда
		
		Возврат Истина;
	Иначе	
		Возврат Ложь;
	КонецЕсли;
КонецФункции


