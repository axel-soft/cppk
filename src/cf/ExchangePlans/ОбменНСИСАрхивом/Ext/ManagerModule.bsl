#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

Функция УзелАрхив() Экспорт
	
	УзелАрхив = Неопределено;
	
	Запрос = Новый Запрос(
		"ВЫБРАТЬ
		|	ОбменНСИСАрхивом.Ссылка КАК Ссылка
		|ИЗ
		|	ПланОбмена.ОбменНСИСАрхивом КАК ОбменНСИСАрхивом
		|ГДЕ
		|	НЕ ОбменНСИСАрхивом.ЭтотУзел");
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		УзелАрхив = Выборка.Ссылка;
	Иначе
		НачатьТранзакцию();
		Попытка
			Блокировки = Новый БлокировкаДанных;
			Блокировка = Блокировки.Добавить("ПланОбмена.ОбменНСИСАрхивом");
			Блокировки.Заблокировать();
			
			Выборка = Запрос.Выполнить().Выбрать();
			Если Выборка.Следующий() Тогда
				УзелАрхив = Выборка.Ссылка;
			Иначе
				УзелАрхивОбъет = ПланыОбмена.ОбменНСИСАрхивом.СоздатьУзел();
				УзелАрхивОбъет.Код = "Архив";
				УзелАрхивОбъет.Наименование = НСтр("ru = 'Архив'");
				УзелАрхивОбъет.Записать();
				УзелАрхив = УзелАрхивОбъет.Ссылка;
			КонецЕсли;
			
			ЗафиксироватьТранзакцию();
		Исключение
			ОтменитьТранзакцию();
			ВызватьИсключение;
		КонецПопытки;
	КонецЕсли;
	
	Возврат УзелАрхив;
	
КонецФункции

#КонецОбласти

#КонецЕсли
